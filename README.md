## Fault-Detector

Сервис для расчета показателя частоты отказов для сервиса. Возвращает частоту отказов для сервиса 
(дробное число от 0 до 1, где 0 это отсутствие ошибок, а 1 - сервис полностью не работает).

Помимо данного параметра так же возвращаются следующие показатели:
 - общее количество операции;
 - общее количество выполняющихся операций;
 - общее количество операций завершенных с ошибкой;
 - общее количество зависших операций.
 
Важно понимать, что данные показатели берутся у последнего преагрегата скользящего окна 
(в качестве алгоритма расчета берется [WMA](WMA.md)).


Принцип работы сервиса следующий:
1. В качестве первого этапа необходимо выполнить процедуру инициализации сбора 
статистики для сервиса. Без этого этапа при попытке добавить операцию будет 
возвращена ошибка. Замечание: проводить инициализацию можно при необходимости 
обнуления статистики для сервиса.
2. Сервис, которому необходимо анализировать работоспособность, отправляет 
данные о операции в Fault Detector (далее FD). После трансформации из thrift 
объекта в POJO данные в виде JSON'a попадают в топик очереди сообщений Kafka. 
3. В определенный промежуток времени запускается задача, которая собирает 
предагрегаты операций на текущий момент. Агрегат собирает промежуточную 
статистику уменьшая количество расходуемой памяти. Важно: хранение 
операций/агрегатов происходит определенное количество времени, которое 
задает родительская система, но ограничено [10, 3600] в секундах. 
Более длительное хранение информации является неактуальным.
4. При запросе статискики сервисом-родителем происходит рассчет уровня ошибок 
с использованием [WMA](WMA.md) алгоритма из имеющихся агрегатов. Также добавляются 
статистические данные последнего агрегата.

**Примечание:** зависшие операции участвуют в расчетах до момента пока их статус не будет
разрешен. Для того чтобы их обнулить необходимо переинициализировать сервис.


[Примерный расчет расходуемой сервисом оперативной памяти](CalculationRAM.md)
